<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Your Personalized Routine</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>

    <script src="https://www.gstatic.com/firebasejs/7.16.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.16.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.16.1/firebase-firestore.js"></script>
    <script>
        var firebaseConfig = {
            apiKey: "AIzaSyBvONbLQcR-XqSsJ9hi7xAsk8sTwej43aA",
            authDomain: "ed-project-42419.firebaseapp.com",
            projectId: "ed-project-42419",
            storageBucket: "ed-project-42419.appspot.com",
            messagingSenderId: "909551078814",
            appId: "1:909551078814:web:456608495b9655eef6da8f"
        };
        firebase.initializeApp(firebaseConfig);
    </script>

    <script src="app.js"></script>

    <style>
        body {
            transition: background-color 0.3s ease;
        }
        .dark {
            background-color: #1a202c;
            color: #e2e8f0;
        }
        .card {
            opacity: 0;
            transform: translateY(20px);
            animation: fadeInUp 0.5s ease forwards;
        }
        @keyframes fadeInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .routine-item {
            opacity: 0;
            animation: fadeIn 0.5s ease forwards;
        }
        @keyframes fadeIn {
            to {
                opacity: 1;
            }
        }
    </style>
</head>
<body class="bg-purple-50 dark:bg-gray-900 transition-colors duration-300">
    <div class="container mx-auto p-8 max-w-2xl">
        <div class="card bg-gradient-to-br from-purple-50 to-blue-50 dark:from-gray-800 dark:to-gray-700 shadow-lg rounded-lg overflow-hidden">
            <div class="p-6 space-y-1 text-center">
                <h1 class="text-3xl font-bold text-gray-800 dark:text-white">Your Personalized Routine</h1>
                <p class="text-lg text-gray-600 dark:text-gray-300">Based on the information you provided</p>
            </div>
            <div class="p-6">
                <div class="space-y-6">
                    <h2 class="text-2xl font-semibold text-center mb-6 text-gray-800 dark:text-white">Daily Schedule</h2>
                    <div class="space-y-4" id="routineItems">
                        <!-- Routine items will be inserted here by JavaScript -->
                    </div>
                </div>
            </div>
            <div class="p-6 flex justify-center">
                <a href="index.html" id="goBackBtn" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded shadow-md transition duration-300 ease-in-out focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50 flex items-center">
                    <i data-lucide="house" class="w-5 h-5 mr-2"></i>
                    back to Home
                </a>
            </div>
        </div>
    </div>
    <button id="darkModeToggle" class="fixed top-4 right-4 bg-gray-200 dark:bg-gray-700 p-2 rounded-full shadow-md">
        <i data-lucide="sun" class="w-6 h-6 text-yellow-500 dark:hidden"></i>
        <i data-lucide="moon" class="w-6 h-6 text-indigo-500 hidden dark:block"></i>
    </button>

    <script>
       let routineItems;

        function fetchRoutines() {
            auth.onAuthStateChanged(user => {
                if (user) {
                    thingsRef = db.collection('routines')
                    unsubscribe = thingsRef
                        .where('uid', '==', user.uid)
                        .onSnapshot(querySnapshot => {
                            routineItems = querySnapshot.docs.map(doc => doc.data().routines)[0];
                            console.log(routineItems);
                            populateRoutineItems();
                        });
                }
            });
        }
        fetchRoutines()

        function createRoutineItem(time, activity, index) {
            const div = document.createElement('div');
            div.className = `routine-item flex items-center justify-between bg-white dark:bg-gray-700 p-4 rounded-lg shadow`;
            div.style.animationDelay = `${index * 0.1}s`;
            div.innerHTML = `
                <span class="font-semibold text-gray-700 dark:text-gray-300">${time}</span>
                <p class="text-gray-600 dark:text-gray-400">${activity}</p>
            `;
            return div;
        }

        function populateRoutineItems() {
            const container = document.getElementById('routineItems');
            container.innerHTML = ''; // Clear existing items
            
            // Convert object to array of [time, activity] pairs
            const items = Object.entries(routineItems);
            
            // Sort items based on start time
            items.sort((a, b) => {
                const timeA = a[0].split(' - ')[0];
                const timeB = b[0].split(' - ')[0];
                return convertTo24Hour(timeA) - convertTo24Hour(timeB);
            });
            
            // Create routine items in the sorted order
            items.forEach((item, index) => {
                const [time, activity] = item;
                container.appendChild(createRoutineItem(time, activity, index));
            });
        }

        function convertTo24Hour(time) {
            const [hours, minutes] = time.split(':').map(Number);
            return hours * 60 + minutes;
        }

        function toggleDarkMode() {
            document.body.classList.toggle('dark');
        }

        lucide.createIcons();
    </script>
</body>
</html>